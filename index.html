<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Presen√ßa com Reconhecimento Facial</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7/dist/blazeface.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab:hover {
            background: #5a6fd8;
            color: white;
        }
        
        .content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .camera-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        #video {
            width: 100%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .person-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .person-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .person-card:hover {
            transform: translateY(-5px);
        }
        
        .person-card.present {
            background: #d4edda;
            border-left: 5px solid #28a745;
        }
        
        .person-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .person-info p {
            margin: 5px 0;
            color: #666;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .status.present {
            background: #28a745;
            color: white;
        }
        
        .status.absent {
            background: #dc3545;
            color: white;
        }
        
        .recognition-result {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .recognition-result.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }
        
        .recognition-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }
        
        .invite-section {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .invite-link {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            word-break: break-all;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .person-list {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Sistema de Presen√ßa</h1>
            <p>Reconhecimento facial inteligente para controle de presen√ßa</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('recognition')">üì∑ Reconhecimento</button>
            <button class="tab" onclick="showTab('register')">‚ûï Cadastrar Pessoa</button>
            <button class="tab" onclick="showTab('list')">üìã Lista de Presen√ßa</button>
            <button class="tab" onclick="showTab('invite')">üìß Convites</button>
        </div>
        
        <div class="content">
            <!-- Aba de Reconhecimento -->
            <div id="recognition" class="tab-content active">
                <h2>Reconhecimento Facial</h2>
                <div class="camera-container">
                    <video id="video" autoplay muted></video>
                    <canvas id="canvas" style="display: none;"></canvas>
                </div>
                <div class="controls">
                    <button class="btn" onclick="startCamera()">üì∑ Iniciar C√¢mera</button>
                    <button class="btn" onclick="stopCamera()">‚èπÔ∏è Parar C√¢mera</button>
                    <button class="btn" onclick="recognizeFace()" id="recognizeBtn" disabled>üîç Reconhecer Rosto</button>
                </div>
                <div id="recognitionResult"></div>
            </div>
            
            <!-- Aba de Cadastro -->
            <div id="register" class="tab-content">
                <h2>Cadastrar Nova Pessoa</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="fullName">Nome Completo:</label>
                        <input type="text" id="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Telefone:</label>
                        <input type="tel" id="phone" required>
                    </div>
                    <div class="camera-container">
                        <video id="registerVideo" autoplay muted style="display: none;"></video>
                        <canvas id="registerCanvas" style="display: none;"></canvas>
                        <div id="photoPreview"></div>
                    </div>
                    <div class="controls">
                        <button type="button" class="btn" onclick="startRegisterCamera()">üì∑ Tirar Foto</button>
                        <button type="button" class="btn" onclick="capturePhoto()" id="captureBtn" disabled>üì∏ Capturar</button>
                        <button type="submit" class="btn" id="saveBtn" disabled>üíæ Salvar Pessoa</button>
                    </div>
                </form>
            </div>
            
            <!-- Aba de Lista -->
            <div id="list" class="tab-content">
                <h2>Lista de Presen√ßa</h2>
                <div class="controls">
                    <button class="btn" onclick="exportAttendance()">üìä Exportar Lista</button>
                    <button class="btn" onclick="clearAttendance()">üîÑ Limpar Presen√ßas</button>
                </div>
                <div id="personList" class="person-list"></div>
            </div>
            
            <!-- Aba de Convites -->
            <div id="invite" class="tab-content">
                <h2>Sistema de Convites</h2>
                <div class="invite-section">
                    <h3>Link de Convite</h3>
                    <p>Compartilhe este link para que as pessoas se cadastrem:</p>
                    <div class="invite-link" id="inviteLink"></div>
                    <button class="btn" onclick="copyInviteLink()">üìã Copiar Link</button>
                </div>
                
                <div id="notifications" style="margin-top: 30px;">
                    <h3>üì¨ Notifica√ß√µes</h3>
                    <div id="notificationsList"></div>
                </div>
                
                <div id="pendingInvites" style="margin-top: 30px;">
                    <h3>üìã Cadastros Pendentes</h3>
                    <div class="controls">
                        <button class="btn" onclick="updateInvitesList()">üîÑ Atualizar Lista</button>
                    </div>
                    <div id="invitesList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let video = null;
        let canvas = null;
        let ctx = null;
        let model = null;
        let stream = null;
        let people = JSON.parse(localStorage.getItem('faceRecognitionPeople') || '[]');
        let attendance = JSON.parse(localStorage.getItem('faceRecognitionAttendance') || '{}');
        let invites = JSON.parse(localStorage.getItem('faceRecognitionInvites') || '[]');

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadModel();
            updatePersonList();
            generateInviteLink();
            checkForInviteRegistration();
            updateNotifications();
            updateInvitesList();
        });

        // Carregar modelo de reconhecimento facial
        async function loadModel() {
            try {
                model = await blazeface.load();
                console.log('Modelo carregado com sucesso');
            } catch (error) {
                console.error('Erro ao carregar modelo:', error);
            }
        }

        // Gerenciamento de abas
        function showTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Parar c√¢mera se mudou de aba
            if (tabName !== 'recognition' && tabName !== 'register') {
                stopCamera();
                stopRegisterCamera();
            }
        }

        // Fun√ß√µes da c√¢mera principal
        async function startCamera() {
            try {
                video = document.getElementById('video');
                canvas = document.getElementById('canvas');
                ctx = canvas.getContext('2d');
                
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 640, height: 480 } 
                });
                video.srcObject = stream;
                
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    document.getElementById('recognizeBtn').disabled = false;
                };
            } catch (error) {
                alert('Erro ao acessar c√¢mera: ' + error.message);
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            if (video) {
                video.srcObject = null;
            }
            document.getElementById('recognizeBtn').disabled = true;
        }

        // Reconhecimento facial
        async function recognizeFace() {
            if (!model || !video) {
                alert('Modelo n√£o carregado ou c√¢mera n√£o iniciada');
                return;
            }

            const resultDiv = document.getElementById('recognitionResult');
            resultDiv.innerHTML = '<div style="text-align: center;">üîç Analisando rosto...</div>';

            try {
                // Capturar frame atual
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imageData = canvas.toDataURL('image/jpeg', 0.8);

                // Detectar rosto
                const predictions = await model.estimateFaces(canvas, false);
                
                if (predictions.length === 0) {
                    resultDiv.innerHTML = '<div class="recognition-result error">‚ùå Nenhum rosto detectado. Posicione-se melhor na c√¢mera.</div>';
                    return;
                }

                // Simular reconhecimento (compara√ß√£o b√°sica com rostos cadastrados)
                const recognizedPerson = await findMatchingPerson(imageData);
                
                if (recognizedPerson) {
                    // Marcar presen√ßa
                    attendance[recognizedPerson.email] = {
                        name: recognizedPerson.fullName,
                        time: new Date().toLocaleString('pt-BR'),
                        present: true
                    };
                    
                    localStorage.setItem('faceRecognitionAttendance', JSON.stringify(attendance));
                    
                    resultDiv.innerHTML = `
                        <div class="recognition-result success">
                            ‚úÖ Bem-vindo(a), ${recognizedPerson.fullName}!<br>
                            Presen√ßa registrada √†s ${new Date().toLocaleTimeString('pt-BR')}
                        </div>
                    `;
                    
                    updatePersonList();
                } else {
                    resultDiv.innerHTML = '<div class="recognition-result error">‚ùå Pessoa n√£o reconhecida. Verifique se est√° cadastrada no sistema.</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="recognition-result error">‚ùå Erro no reconhecimento: ' + error.message + '</div>';
            }
        }

        // Fun√ß√£o para encontrar pessoa correspondente (simula√ß√£o)
        async function findMatchingPerson(imageData) {
            // Esta √© uma simula√ß√£o. Em um sistema real, usar√≠amos algoritmos de compara√ß√£o facial
            // Por enquanto, vamos usar uma l√≥gica simples baseada no tempo de cadastro
            if (people.length === 0) return null;
            
            // Simular reconhecimento retornando uma pessoa aleat√≥ria para demonstra√ß√£o
            // Em produ√ß√£o, isso seria substitu√≠do por compara√ß√£o real de caracter√≠sticas faciais
            const randomIndex = Math.floor(Math.random() * people.length);
            return people[randomIndex];
        }

        // Fun√ß√µes da c√¢mera de cadastro
        let registerVideo = null;
        let registerCanvas = null;
        let registerStream = null;
        let capturedPhoto = null;

        async function startRegisterCamera() {
            try {
                registerVideo = document.getElementById('registerVideo');
                registerCanvas = document.getElementById('registerCanvas');
                
                registerStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 640, height: 480 } 
                });
                registerVideo.srcObject = registerStream;
                registerVideo.style.display = 'block';
                
                registerVideo.onloadedmetadata = () => {
                    registerCanvas.width = registerVideo.videoWidth;
                    registerCanvas.height = registerVideo.videoHeight;
                    document.getElementById('captureBtn').disabled = false;
                };
            } catch (error) {
                alert('Erro ao acessar c√¢mera: ' + error.message);
            }
        }

        function stopRegisterCamera() {
            if (registerStream) {
                registerStream.getTracks().forEach(track => track.stop());
                registerStream = null;
            }
            if (registerVideo) {
                registerVideo.srcObject = null;
                registerVideo.style.display = 'none';
            }
            document.getElementById('captureBtn').disabled = true;
        }

        function capturePhoto() {
            if (!registerVideo) return;
            
            const ctx = registerCanvas.getContext('2d');
            ctx.drawImage(registerVideo, 0, 0, registerCanvas.width, registerCanvas.height);
            capturedPhoto = registerCanvas.toDataURL('image/jpeg', 0.8);
            
            // Mostrar preview
            document.getElementById('photoPreview').innerHTML = `
                <img src="${capturedPhoto}" style="max-width: 300px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                <p style="margin-top: 10px; color: #28a745; font-weight: bold;">‚úÖ Foto capturada com sucesso!</p>
            `;
            
            document.getElementById('saveBtn').disabled = false;
            stopRegisterCamera();
        }

        // Cadastro de pessoa
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            
            if (!capturedPhoto) {
                alert('Por favor, capture uma foto antes de salvar.');
                return;
            }
            
            // Verificar se email j√° existe
            if (people.find(p => p.email === email)) {
                alert('Este email j√° est√° cadastrado.');
                return;
            }
            
            const newPerson = {
                id: Date.now(),
                fullName,
                email,
                phone,
                photo: capturedPhoto,
                registeredAt: new Date().toLocaleString('pt-BR')
            };
            
            people.push(newPerson);
            localStorage.setItem('faceRecognitionPeople', JSON.stringify(people));
            
            // Limpar formul√°rio
            document.getElementById('registerForm').reset();
            document.getElementById('photoPreview').innerHTML = '';
            capturedPhoto = null;
            document.getElementById('saveBtn').disabled = true;
            
            alert('Pessoa cadastrada com sucesso!');
            updatePersonList();
        });

        // Atualizar lista de pessoas
        function updatePersonList() {
            const listDiv = document.getElementById('personList');
            
            if (people.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #666; font-size: 18px;">Nenhuma pessoa cadastrada ainda.</p>';
                return;
            }
            
            listDiv.innerHTML = people.map(person => {
                const isPresent = attendance[person.email]?.present || false;
                const attendanceTime = attendance[person.email]?.time || '';
                
                return `
                    <div class="person-card ${isPresent ? 'present' : ''}">
                        <div class="person-info">
                            <h3>${person.fullName}</h3>
                            <p><strong>Email:</strong> ${person.email}</p>
                            <p><strong>Telefone:</strong> ${person.phone}</p>
                            <p><strong>Cadastrado em:</strong> ${person.registeredAt}</p>
                            ${isPresent ? `<p><strong>Presente desde:</strong> ${attendanceTime}</p>` : ''}
                            <span class="status ${isPresent ? 'present' : 'absent'}">
                                ${isPresent ? '‚úÖ Presente' : '‚ùå Ausente'}
                            </span>
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn" onclick="removePerson('${person.email}')" style="background: #dc3545;">üóëÔ∏è Remover</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Remover pessoa
        function removePerson(email) {
            if (confirm('Tem certeza que deseja remover esta pessoa?')) {
                people = people.filter(p => p.email !== email);
                delete attendance[email];
                
                localStorage.setItem('faceRecognitionPeople', JSON.stringify(people));
                localStorage.setItem('faceRecognitionAttendance', JSON.stringify(attendance));
                
                updatePersonList();
            }
        }

        // Exportar lista de presen√ßa
        function exportAttendance() {
            const attendanceData = people.map(person => ({
                nome: person.fullName,
                email: person.email,
                telefone: person.phone,
                presente: attendance[person.email]?.present ? 'Sim' : 'N√£o',
                horario: attendance[person.email]?.time || 'N/A'
            }));
            
            const csv = [
                ['Nome', 'Email', 'Telefone', 'Presente', 'Hor√°rio'],
                ...attendanceData.map(row => [row.nome, row.email, row.telefone, row.presente, row.horario])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lista_presenca_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Limpar presen√ßas
        function clearAttendance() {
            if (confirm('Tem certeza que deseja limpar todas as presen√ßas?')) {
                attendance = {};
                localStorage.setItem('faceRecognitionAttendance', JSON.stringify(attendance));
                updatePersonList();
            }
        }

        // Sistema de convites
        function generateInviteLink() {
            const baseUrl = window.location.origin + window.location.pathname;
            const inviteCode = btoa('invite_' + Date.now()).replace(/[^a-zA-Z0-9]/g, '').substring(0, 10);
            const inviteUrl = `${baseUrl}?invite=${inviteCode}`;
            
            document.getElementById('inviteLink').textContent = inviteUrl;
            localStorage.setItem('faceRecognitionInviteCode', inviteCode);
        }

        function copyInviteLink() {
            const link = document.getElementById('inviteLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('Link copiado para a √°rea de transfer√™ncia!');
            });
        }

        // Verificar se √© um acesso via convite
        function checkForInviteRegistration() {
            const urlParams = new URLSearchParams(window.location.search);
            const inviteCode = urlParams.get('invite');
            
            if (inviteCode) {
                // Mostrar formul√°rio de auto-cadastro
                showInviteRegistrationForm();
            }
        }

        function showInviteRegistrationForm() {
            // Criar modal para auto-cadastro
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                    <h2 style="text-align: center; color: #667eea; margin-bottom: 20px;">üìù Cadastro por Convite</h2>
                    <form id="inviteForm">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nome Completo:</label>
                            <input type="text" id="inviteFullName" required style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email:</label>
                            <input type="email" id="inviteEmail" required style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Telefone:</label>
                            <input type="tel" id="invitePhone" required style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px;">
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button type="submit" class="btn">‚úÖ Confirmar Cadastro</button>
                            <button type="button" class="btn" onclick="closeInviteModal()" style="background: #6c757d; margin-left: 10px;">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.inviteModal = modal;
            
            // Adicionar evento ao formul√°rio
            document.getElementById('inviteForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const fullName = document.getElementById('inviteFullName').value;
                const email = document.getElementById('inviteEmail').value;
                const phone = document.getElementById('invitePhone').value;
                
                // Adicionar √† lista de convites pendentes
                const invite = {
                    id: Date.now(),
                    fullName,
                    email,
                    phone,
                    invitedAt: new Date().toLocaleString('pt-BR'),
                    status: 'pending'
                };
                
                invites.push(invite);
                localStorage.setItem('faceRecognitionInvites', JSON.stringify(invites));
                
                // Enviar notifica√ß√£o por email
                sendEmailNotification(invite);
                
                alert('Cadastro realizado com sucesso! Uma notifica√ß√£o foi enviada ao administrador.');
                closeInviteModal();
            });
        }

        function closeInviteModal() {
            if (window.inviteModal) {
                document.body.removeChild(window.inviteModal);
                window.inviteModal = null;
            }
        }

        // Fun√ß√£o para enviar notifica√ß√£o por email
        function sendEmailNotification(invite) {
            const adminEmail = 'paulo.henrique72681@gmail.com';
            const subject = `Novo Cadastro no Sistema de Presen√ßa - ${invite.fullName}`;
            const body = `
Ol√°!

Uma nova pessoa se cadastrou no sistema de reconhecimento facial:

üìù DADOS DO CADASTRO:
‚Ä¢ Nome: ${invite.fullName}
‚Ä¢ Email: ${invite.email}
‚Ä¢ Telefone: ${invite.phone}
‚Ä¢ Data/Hora: ${invite.invitedAt}

üîó Para aprovar o cadastro, acesse o sistema e v√° na aba "Convites".

---
Sistema de Presen√ßa com Reconhecimento Facial
            `.trim();

            // Criar link mailto
            const mailtoLink = `mailto:${adminEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Tentar abrir cliente de email
            try {
                window.open(mailtoLink, '_blank');
            } catch (error) {
                console.log('Email notification prepared for:', adminEmail);
            }

            // Tamb√©m salvar notifica√ß√£o no sistema para visualiza√ß√£o
            const notifications = JSON.parse(localStorage.getItem('faceRecognitionNotifications') || '[]');
            notifications.push({
                id: Date.now(),
                type: 'new_registration',
                data: invite,
                timestamp: new Date().toLocaleString('pt-BR'),
                read: false
            });
            localStorage.setItem('faceRecognitionNotifications', JSON.stringify(notifications));
        }

        // Atualizar lista de notifica√ß√µes
        function updateNotifications() {
            const notifications = JSON.parse(localStorage.getItem('faceRecognitionNotifications') || '[]');
            const notificationsDiv = document.getElementById('notificationsList');
            
            if (notifications.length === 0) {
                notificationsDiv.innerHTML = '<p style="color: #666; text-align: center;">Nenhuma notifica√ß√£o ainda.</p>';
                return;
            }
            
            notificationsDiv.innerHTML = notifications.reverse().map(notification => `
                <div style="background: ${notification.read ? '#f8f9fa' : '#e3f2fd'}; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #667eea;">
                    <div style="display: flex; justify-content: between; align-items: center;">
                        <div style="flex: 1;">
                            <h4 style="color: #667eea; margin: 0 0 10px 0;">üìß Novo Cadastro Recebido</h4>
                            <p><strong>Nome:</strong> ${notification.data.fullName}</p>
                            <p><strong>Email:</strong> ${notification.data.email}</p>
                            <p><strong>Telefone:</strong> ${notification.data.phone}</p>
                            <p><strong>Data:</strong> ${notification.timestamp}</p>
                        </div>
                        <div>
                            <button class="btn" onclick="approveInvite('${notification.data.email}')" style="background: #28a745; margin: 2px;">‚úÖ Aprovar</button>
                            <button class="btn" onclick="rejectInvite('${notification.id}')" style="background: #dc3545; margin: 2px;">‚ùå Rejeitar</button>
                            <button class="btn" onclick="markAsRead('${notification.id}')" style="background: #6c757d; margin: 2px;">üëÅÔ∏è Marcar Lida</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Atualizar lista de convites pendentes
        function updateInvitesList() {
            const invitesDiv = document.getElementById('invitesList');
            
            if (invites.length === 0) {
                invitesDiv.innerHTML = '<p style="color: #666; text-align: center;">Nenhum convite pendente.</p>';
                return;
            }
            
            invitesDiv.innerHTML = invites.filter(invite => invite.status === 'pending').map(invite => `
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #ffc107;">
                    <h4 style="color: #856404; margin: 0 0 10px 0;">‚è≥ Aguardando Aprova√ß√£o</h4>
                    <p><strong>Nome:</strong> ${invite.fullName}</p>
                    <p><strong>Email:</strong> ${invite.email}</p>
                    <p><strong>Telefone:</strong> ${invite.phone}</p>
                    <p><strong>Cadastrado em:</strong> ${invite.invitedAt}</p>
                    <div style="margin-top: 10px;">
                        <button class="btn" onclick="approveInvite('${invite.email}')" style="background: #28a745;">‚úÖ Aprovar e Cadastrar</button>
                        <button class="btn" onclick="rejectInvite('${invite.id}')" style="background: #dc3545;">‚ùå Rejeitar</button>
                    </div>
                </div>
            `).join('');
        }

        // Aprovar convite e cadastrar pessoa
        function approveInvite(email) {
            const invite = invites.find(inv => inv.email === email);
            if (!invite) return;
            
            // Verificar se j√° n√£o est√° cadastrado
            if (people.find(p => p.email === email)) {
                alert('Esta pessoa j√° est√° cadastrada no sistema.');
                return;
            }
            
            // Adicionar √† lista de pessoas (sem foto por enquanto)
            const newPerson = {
                id: Date.now(),
                fullName: invite.fullName,
                email: invite.email,
                phone: invite.phone,
                photo: null, // Ser√° adicionada quando a pessoa fizer o reconhecimento
                registeredAt: new Date().toLocaleString('pt-BR'),
                approvedAt: new Date().toLocaleString('pt-BR'),
                fromInvite: true
            };
            
            people.push(newPerson);
            localStorage.setItem('faceRecognitionPeople', JSON.stringify(people));
            
            // Marcar convite como aprovado
            invite.status = 'approved';
            invite.approvedAt = new Date().toLocaleString('pt-BR');
            localStorage.setItem('faceRecognitionInvites', JSON.stringify(invites));
            
            alert(`${invite.fullName} foi aprovado(a) e cadastrado(a) no sistema!`);
            updatePersonList();
            updateInvitesList();
            updateNotifications();
        }

        // Rejeitar convite
        function rejectInvite(inviteId) {
            if (confirm('Tem certeza que deseja rejeitar este cadastro?')) {
                const inviteIndex = invites.findIndex(inv => inv.id == inviteId);
                if (inviteIndex > -1) {
                    invites[inviteIndex].status = 'rejected';
                    invites[inviteIndex].rejectedAt = new Date().toLocaleString('pt-BR');
                    localStorage.setItem('faceRecognitionInvites', JSON.stringify(invites));
                }
                
                // Remover notifica√ß√£o
                const notifications = JSON.parse(localStorage.getItem('faceRecognitionNotifications') || '[]');
                const filteredNotifications = notifications.filter(n => n.id != inviteId);
                localStorage.setItem('faceRecognitionNotifications', JSON.stringify(filteredNotifications));
                
                updateInvitesList();
                updateNotifications();
            }
        }

        // Marcar notifica√ß√£o como lida
        function markAsRead(notificationId) {
            const notifications = JSON.parse(localStorage.getItem('faceRecognitionNotifications') || '[]');
            const notification = notifications.find(n => n.id == notificationId);
            if (notification) {
                notification.read = true;
                localStorage.setItem('faceRecognitionNotifications', JSON.stringify(notifications));
                updateNotifications();
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'971b2351f5569522',t:'MTc1NTYyMjEwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
